(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{187:function(e,t,a){e.exports=a(289)},192:function(e,t,a){},289:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(7),o=a.n(c),s=(a(192),a(119),a(46)),i=(a(194),a(153)),u=(a(196),a(156)),l=(a(197),a(151)),f=a(152),p=(a(199),a(155)),d=a(24),h=a(13),m=a.n(h),b=a(154),g=a(31),v=a(61),x=a.n(v),y=(a(203),a(142)),k=(a(290),a(150)),j=(a(207),a(9)),E=a(16),O=a(139),w=a(140),C=a(157),_=a(141),A=a(58),B=a(158),S=a(39),N=a.n(S),R=function(e){function t(e){var a;return Object(O.a)(this,t),(a=Object(C.a)(this,Object(_.a)(t).call(this,e))).moveToDate=function(e){var t=Object(A.a)(a),n=t.width,r=t.height,c=t.svg,o=t.yScale,s=t.user2Color;return new Promise((function(t){var a=E.j().duration(100).on("end",t),i=Object.keys(e).map((function(t){return{name:t,value:e[t]||0}})).sort((function(e,t){return E.a(e.value,t.value)})),u=E.e(i,(function(e){return e.value})),l=E.g().range([0,n]).domain([0,u<10?10:u]);o.domain(i.map((function(e){return e.name})));var f=c.select(".x.axis");f.empty()&&(f=c.append("g").attr("class","x axis").attr("transform","translate(0,".concat(r,")"))),f.transition(a).call(E.b(l)).selectAll("g");var p=c.select(".y.axis");p.empty()&&(p=c.append("g").attr("class","y axis"));var d=c.select(".bars-g");d.empty()&&(d=c.append("g").attr("class","bars-g"));var h=d.selectAll(".bar").data(i,(function(e){return e.name}));h.exit().remove(),h.enter().append("rect").attr("class","bar").attr("x",0).merge(h).style("fill",(function(e){return s[e.name]||"#333"})).transition(a).attr("height",(function(){return o.bandwidth()})).attr("y",(function(e){return o(e.name)})).attr("width",(function(e){return l(e.value)}));var m=d.selectAll(".label").data(i,(function(e){return e.name}));m.exit().remove(),m.enter().append("text").attr("class","label").attr("x",(function(e){return 0})).merge(m).transition(a).attr("y",(function(e){return o(e.name)+o.bandwidth()/2+4})).attr("x",(function(e){return l(e.value)+3})).tween("text",(function(e){var t=E.i(this),a=E.i(this).text(),n=e.value,r=E.d(a,n);return function(e){t.text(Math.round(r(e)))}})),p.transition(a).call(E.c(o)).selectAll("g")}))},a.chart=r.a.createRef(),a.user2Color={},a}return Object(B.a)(t,e),Object(w.a)(t,[{key:"componentDidMount",value:function(){var e=0,t=40,a=30,n=120,r=this.chart.current.parentNode.clientWidth-n-t,c=this.chart.current.parentNode.clientHeight-e-a;this.width=r,this.height=c,this.svg=E.i(this.chart.current).attr("width",r+n+t).attr("height",c+e+a).append("g").attr("transform","translate(".concat(n,",").concat(e,")")),this.yScale=E.f().rangeRound([c,0],.1).padding(.4),console.log(this)}},{key:"render",value:function(){return r.a.createElement("div",{style:{height:400},className:N.a.racingBarChart},r.a.createElement("svg",{ref:this.chart}))}}]),t}(r.a.Component),D=function(e){var t=e.data,a=e.users,c=e.loading,o=Object(n.useRef)(null),s=Object(n.useRef)(0),i=Object(n.useState)(0),u=Object(d.a)(i,2),l=u[0],f=u[1],p=Object(n.useState)(!1),h=Object(d.a)(p,2),b=h[0],v=h[1];Object(n.useEffect)((function(){if(a){var e={};a.forEach((function(t,a){e[t]=E.h[a]})),o.current.user2Color=e}}),[a]),Object(n.useEffect)((function(){o.current&&o.current.moveToDate({})}),[o]),Object(n.useEffect)((function(){if(!b&&t){var e=t[l].likeCounts;o.current.moveToDate(e)}}),[l]);var x=Object(n.useCallback)(Object(g.a)(m.a.mark((function e(){var a,n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:v(!0),a=++s.current,(n=l)===t.length-1&&(n=0);case 6:if(!(n<t.length)){e.next=17;break}if(a===s.current){e.next=10;break}return v(!1),e.abrupt("return");case 10:return r=t[n].likeCounts,f(n),e.next=14,o.current.moveToDate(r);case 14:n++,e.next=6;break;case 17:v(!1);case 18:case"end":return e.stop()}}),e)}))),[t,l]);return Object(n.useEffect)((function(){f(0),t&&c&&x()}),[t,c]),r.a.createElement(y.a,{spinning:c},r.a.createElement("div",{style:{background:"#fff",padding:16,marginTop:16}},r.a.createElement("h2",{style:{textAlign:"center"}},t&&t[l]&&t[l].date),r.a.createElement(R,{ref:o}),r.a.createElement("div",{className:N.a.iconWrapper},!b&&r.a.createElement(j.a,{className:N.a.play,type:"caret-right",onClick:x,disabled:!t}),b&&r.a.createElement(j.a,{className:N.a.play,type:"pause",onClick:Object(g.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:s.current++,v(!1);case 4:case"end":return e.stop()}}),e)}))),disabled:!t}),r.a.createElement(k.a,{min:0,max:t?t.length-1:0,value:l,onChange:function(e){s.current++,f(e)},tipFormatter:function(e){return t?t[e].date:null}}))))},H=(a(276),a(47)),L=a(85),T=a.n(L),q=H.a.Header,W=H.a.Content,Y=H.a.Footer,J=function(e){var t=e.children;return r.a.createElement(H.a,null,r.a.createElement(q,{className:T.a.header},r.a.createElement("div",{className:T.a.title},"Qiita Racing")),r.a.createElement(W,{style:{padding:"0 50px"}},r.a.createElement("div",{style:{padding:24,minHeight:"calc(100vh - 64px  - 69px)"}},t)),r.a.createElement(Y,{style:{textAlign:"center"}},"\xa9React App"))},M="6ab1aebe3d1999c206ae14ddbb366f6a65759bf2",z="190fe6a7296c449bf9af82e3d25132e765ad8f3e";function F(e,t){return P.apply(this,arguments)}function P(){return(P=Object(g.a)(m.a.mark((function e(t,a){var n,r,c,o,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=100,r=1,c=[];case 3:return e.next=5,fetch("https://qiita.com/api/v2/users/".concat(t,"/items?page=").concat(r,"&per_page=").concat(n),{mode:"cors",method:"get",headers:{Authorization:"Bearer ".concat(a),"Access-Control-Allow-Headers":"total-count","Access-Control-Expose-Headers":"total-count"}});case 5:if((s=e.sent).ok){e.next=8;break}throw new Error;case 8:return e.next=10,s.json();case 10:o=e.sent,c=c.concat(o),r++;case 13:if(n===o.length){e.next=3;break}case 14:return e.abrupt("return",c);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t){return Z.apply(this,arguments)}function Z(){return(Z=Object(g.a)(m.a.mark((function e(t,a){var n,r,c,o,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=100,r=1,c=[];case 3:return e.next=5,fetch("https://qiita.com/api/v2/items/".concat(t,"/likes?page=").concat(r,"&per_page=").concat(n),{mode:"cors",method:"get",headers:{Authorization:"Bearer ".concat(a),"Access-Control-Allow-Headers":"total-count","Access-Control-Expose-Headers":"total-count"}});case 5:if((s=e.sent).ok){e.next=8;break}throw new Error;case 8:return e.next=10,s.json();case 10:o=e.sent,c=c.concat(o),r++;case 13:if(n===o.length){e.next=3;break}case 14:return e.abrupt("return",c);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Q=function(){var e=Object(g.a)(m.a.mark((function e(t,a){var n,r,c,o,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=m.a.mark((function e(r){var c,o,s,i,u,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t[r],e.next=3,F(c,a);case 3:o=e.sent,s=[],i=0;case 6:if(!(i<o.length)){e.next=15;break}return u=o[i],e.next=10,I(u.id,a);case 10:l=e.sent,s=s.concat(l);case 12:i++,e.next=6;break;case 15:s.forEach((function(e){var t=e.created_at,a=x()(t).format("YYYY-MM-DD");n[a]||(n[a]={}),n[a][c]||(n[a][c]=0),n[a][c]++}));case 16:case"end":return e.stop()}}),e)})),c=0;case 3:if(!(c<t.length)){e.next=8;break}return e.delegateYield(r(c),"t0",5);case 5:c++,e.next=3;break;case 8:return o={},t.forEach((function(e){o[e]=0})),s=[],Object.keys(n).forEach((function(e){s.push({date:e,likeCounts:Object(b.a)({},o,{},n[e])})})),s.sort((function(e,t){return x()(e.date)-x()(t.date)})),s=s.map((function(e,a){return s[a-1]?(t.forEach((function(t){e.likeCounts[t]=e.likeCounts[t]||0,e.likeCounts[t]+=s[a-1].likeCounts[t]})),e):e})),e.abrupt("return",s);case 15:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function U(){return(U=Object(g.a)(m.a.mark((function e(t){var a,n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://qiita.com/api/v2/access_tokens",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:M,client_secret:z,code:t})});case 2:if((a=e.sent).ok){e.next=5;break}throw new Error;case 5:return e.next=7,a.json();case 7:return n=e.sent,r=n.token,e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){window.location.href="https://qiita.com/api/v2/oauth/authorize?client_id=".concat(M,"&scope=read_qiita")}var G=function(){var e=Object(n.useState)(!1),t=Object(d.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(Array(8).fill(null)),h=Object(d.a)(o,2),m=h[0],b=h[1],g=Object(n.useState)(null),v=Object(d.a)(g,2),x=v[0],y=v[1],k=Object(n.useState)(null),j=Object(d.a)(k,2),E=j[0],O=j[1],w=Object(n.useState)(null),C=Object(d.a)(w,2),_=C[0],A=C[1],B=Object(n.useState)(!1),S=Object(d.a)(B,2),N=S[0],R=S[1];return Object(n.useEffect)((function(){var e=new URL(window.location.href),t=e.searchParams.get("token"),a=e.searchParams.get("code");t?A(t):a?function(e){return U.apply(this,arguments)}(a).then((function(e){window.location.href="?token=".concat(e)})).catch((function(){V()})):V()}),[]),_?r.a.createElement(J,null,r.a.createElement("div",{style:{background:"#fff",padding:16}},N&&r.a.createElement(p.a,{type:"error",message:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002",style:{marginBottom:8}}),r.a.createElement(i.a,{gutter:8},m.map((function(e,t){return r.a.createElement(u.a,{key:t,span:6,style:{marginBottom:8}},r.a.createElement(l.a,{placeholder:"\u30e6\u30fc\u30b6\u30fcID\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",value:e,onChange:function(e){var a=Object(f.a)(m);a[t]=e.target.value,b(a)}}))}))),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement(s.a,{type:"primary",block:!0,onClick:function(){var e=m.filter((function(e){return e}));0!==e.length&&(y(null),R(!1),O(null),c(!0),Q(e,_).then((function(t){y(t),O(e),c(!1)})).catch((function(e){console.log(e),c(!1),R(!0)})))},disabled:!_,loading:a},"\u30c7\u30fc\u30bf\u53d6\u5f97"))),r.a.createElement(D,{data:x,loading:a,users:E})):r.a.createElement(J,null,r.a.createElement("div",null,"\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002"))};var K=function(){return r.a.createElement(G,null)};o.a.render(r.a.createElement(K,null),document.getElementById("root"))},39:function(e,t,a){e.exports={iconWrapper:"src-components-index-module__iconWrapper--J5FWB",play:"src-components-index-module__play--2x7ZR",stop:"src-components-index-module__stop--3RwOC",racingBarChart:"src-components-index-module__racingBarChart--1Zk1V"}},85:function(e,t,a){e.exports={header:"src-layouts-BasicLayout-index-module__header--2S57j",title:"src-layouts-BasicLayout-index-module__title--321a5",logo:"src-layouts-BasicLayout-index-module__logo--1Hx4w",spacer:"src-layouts-BasicLayout-index-module__spacer--1sAL6"}}},[[187,1,2]]]);
//# sourceMappingURL=main.1a329fcd.chunk.js.map