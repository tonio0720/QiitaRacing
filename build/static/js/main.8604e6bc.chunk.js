(this["webpackJsonpqiita-racer"]=this["webpackJsonpqiita-racer"]||[]).push([[0],{136:function(e,t,a){e.exports={racingBarChart:"src-components-RacingBarChart-index-module__racingBarChart--27osw"}},170:function(e,t,a){e.exports=a(289)},175:function(e,t,a){},289:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(7),o=a.n(c),i=(a(175),a(93)),u=(a(105),a(52)),s=(a(177),a(149)),l=(a(179),a(151)),f=(a(180),a(147)),p=a(148),d=(a(182),a(98)),m=a(25),h=a(13),b=a.n(h),v=a(150),g=a(30),x=a(53),y=a.n(x),k=a(67),O=a.n(k),j=a(37),E=(a(202),a(137)),w=(a(290),a(146)),C=(a(206),a(9)),_=a(133),S=a(134),B=a(152),A=a(135),N=a(64),q=a(153),I=a(22),L=a(136),R=a.n(L),D=function(e){function t(e){var a;return Object(_.a)(this,t),(a=Object(B.a)(this,Object(A.a)(t).call(this,e))).moveToDate=function(e){var t=Object(N.a)(a),n=t.width,r=t.height,c=t.svg,o=t.yScale,i=t.user2Color;return new Promise((function(t){var a=I.i().duration(100).on("end",t),u=Object.keys(e).map((function(t){return{name:t,value:e[t]||0}})).sort((function(e,t){return I.a(e.value,t.value)})),s=I.e(u,(function(e){return e.value})),l=I.g().range([0,n]).domain([0,s<10?10:s]);o.domain(u.map((function(e){return e.name})));var f=c.select(".x.axis");f.empty()&&(f=c.append("g").attr("class","x axis").attr("transform","translate(0,".concat(r,")"))),f.transition(a).call(I.b(l)).selectAll("g");var p=c.select(".y.axis");p.empty()&&(p=c.append("g").attr("class","y axis"));var d=c.select(".bars-g");d.empty()&&(d=c.append("g").attr("class","bars-g"));var m=d.selectAll(".bar").data(u,(function(e){return e.name}));m.exit().remove(),m.enter().append("rect").attr("class","bar").attr("x",0).merge(m).style("fill",(function(e){return i[e.name]||"#333"})).transition(a).attr("height",(function(){return o.bandwidth()})).attr("y",(function(e){return o(e.name)})).attr("width",(function(e){return l(e.value)}));var h=d.selectAll(".label").data(u,(function(e){return e.name}));h.exit().remove(),h.enter().append("text").attr("class","label").attr("x",(function(e){return 0})).merge(h).transition(a).attr("y",(function(e){return o(e.name)+o.bandwidth()/2+4})).attr("x",(function(e){return l(e.value)+3})).tween("text",(function(e){var t=I.h(this),a=I.h(this).text(),n=e.value,r=I.d(a,n);return function(e){t.text(Math.round(r(e)))}})),p.transition(a).call(I.c(o)).selectAll("g")}))},a.chart=r.a.createRef(),a.user2Color={},a}return Object(q.a)(t,e),Object(S.a)(t,[{key:"componentDidMount",value:function(){var e=0,t=40,a=30,n=120,r=this.chart.current.parentNode.clientWidth-n-t,c=this.chart.current.parentNode.clientHeight-e-a;this.width=r,this.height=c,this.svg=I.h(this.chart.current).attr("width",r+n+t).attr("height",c+e+a).append("g").attr("transform","translate(".concat(n,",").concat(e,")")),this.yScale=I.f().rangeRound([c,0],.1).padding(.4),console.log(this)}},{key:"render",value:function(){return r.a.createElement("div",{style:{height:400},className:R.a.racingBarChart},r.a.createElement("svg",{ref:this.chart}))}}]),t}(r.a.Component),T=a(68),M=a.n(T),P=["#1890ff","#fa8c16","#52c41a","#f5222d","#722ed1","#eb2f96","#a0d911","#13c2c2"],Y=function(e){var t=e.data,a=e.users,c=e.loading,o=Object(n.useRef)(null),i=Object(n.useRef)(0),u=Object(n.useState)(0),s=Object(m.a)(u,2),l=s[0],f=s[1],p=Object(n.useState)(!1),d=Object(m.a)(p,2),h=d[0],v=d[1];Object(n.useEffect)((function(){if(a){var e={};a.forEach((function(t,a){e[t]=P[a]})),o.current.user2Color=e}}),[a]),Object(n.useEffect)((function(){o.current&&o.current.moveToDate({})}),[o]),Object(n.useEffect)((function(){if(!h&&t){var e=t[l].likeCounts;o.current.moveToDate(e)}}),[l]);var x=Object(n.useCallback)(Object(g.a)(b.a.mark((function e(){var a,n,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:v(!0),a=++i.current,(n=l)===t.length-1&&(n=0);case 6:if(!(n<t.length)){e.next=17;break}if(a===i.current){e.next=10;break}return v(!1),e.abrupt("return");case 10:return r=t[n].likeCounts,f(n),e.next=14,o.current.moveToDate(r);case 14:n++,e.next=6;break;case 17:v(!1);case 18:case"end":return e.stop()}}),e)}))),[t,l]);return Object(n.useEffect)((function(){f(0),t&&c&&x()}),[t,c]),r.a.createElement(E.a,{spinning:c},r.a.createElement("div",{style:{background:"#fff",padding:16,marginTop:16}},r.a.createElement("h2",{style:{textAlign:"center"}},t&&t[l]&&t[l].date),r.a.createElement(D,{ref:o}),r.a.createElement("div",{className:M.a.iconWrapper},!h&&r.a.createElement(C.a,{className:M.a.play,type:"caret-right",onClick:x,disabled:!t}),h&&r.a.createElement(C.a,{className:M.a.play,type:"pause",onClick:Object(g.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:i.current++,v(!1);case 4:case"end":return e.stop()}}),e)}))),disabled:!t}),r.a.createElement(w.a,{min:0,max:t?t.length-1:0,value:l,onChange:function(e){i.current++,f(e)},tipFormatter:function(e){return t?t[e].date:null}}))))},z=(a(274),a(54)),H=a(95),J=a.n(H),W=z.a.Header,F=z.a.Content,Q=z.a.Footer,G=function(e){var t=e.children;return r.a.createElement(z.a,null,r.a.createElement(W,{className:J.a.header},r.a.createElement("div",{className:J.a.title},"Qiita Racer")),r.a.createElement(F,null,r.a.createElement("div",{style:{padding:24,minHeight:"calc(100vh - 64px  - 69px)"}},t)),r.a.createElement(Q,{style:{textAlign:"center"}},"\xa9React App"))},K="6ab1aebe3d1999c206ae14ddbb366f6a65759bf2",U="190fe6a7296c449bf9af82e3d25132e765ad8f3e";function Z(){return(Z=Object(g.a)(b.a.mark((function e(t){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.get("https://qiita.com/api/v2/items",{headers:{Authorization:"Bearer ".concat(t)}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){return X.apply(this,arguments)}function X(){return(X=Object(g.a)(b.a.mark((function e(t,a){var n,r,c,o,i,u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=100,r=1,c=[];case 3:return e.next=5,y.a.get("https://qiita.com/api/v2/users/".concat(t,"/items?page=").concat(r,"&per_page=").concat(n),{headers:{Authorization:"Bearer ".concat(a)}});case 5:if(i=e.sent,u=0,i.data.forEach((function(e){var t=e.likes_count;u+=t})),!(u>1e3)){e.next=10;break}throw new Error("Over1000LikesCount");case 10:o=Number(i.headers["total-count"]),c=c.concat(i.data);case 12:if(r++*n<o){e.next=3;break}case 13:return e.abrupt("return",c);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return ee.apply(this,arguments)}function ee(){return(ee=Object(g.a)(b.a.mark((function e(t,a){var n,r,c,o,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=100,r=1,c=[];case 3:return e.next=5,y.a.get("https://qiita.com/api/v2/items/".concat(t,"/likes?page=").concat(r,"&per_page=").concat(n),{headers:{Authorization:"Bearer ".concat(a)}});case 5:i=e.sent,o=Number(i.headers["total-count"]),c=c.concat(i.data);case 8:if(r++*n<o){e.next=3;break}case 9:return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=function(){var e=Object(g.a)(b.a.mark((function e(t,a){var n,r,c,o,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=b.a.mark((function e(r){var c,o,i,u,s,l;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t[r],e.next=3,V(c,a);case 3:o=e.sent,i=[],u=0;case 6:if(!(u<o.length)){e.next=15;break}return s=o[u],e.next=10,$(s.id,a);case 10:l=e.sent,i=i.concat(l);case 12:u++,e.next=6;break;case 15:i.forEach((function(e){var t=e.created_at,a=O()(t).format("YYYY-MM-DD");n[a]||(n[a]={}),n[a][c]||(n[a][c]=0),n[a][c]++}));case 16:case"end":return e.stop()}}),e)})),c=0;case 3:if(!(c<t.length)){e.next=8;break}return e.delegateYield(r(c),"t0",5);case 5:c++,e.next=3;break;case 8:return o={},t.forEach((function(e){o[e]=0})),i=[],Object.keys(n).forEach((function(e){i.push({date:e,likeCounts:Object(v.a)({},o,{},n[e])})})),i.sort((function(e,t){return O()(e.date)-O()(t.date)})),i=i.map((function(e,a){return i[a-1]?(t.forEach((function(t){e.likeCounts[t]=e.likeCounts[t]||0,e.likeCounts[t]+=i[a-1].likeCounts[t]})),e):e})),e.abrupt("return",i);case 15:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function ae(){return(ae=Object(g.a)(b.a.mark((function e(t){var a,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.a.post("https://qiita.com/api/v2/access_tokens",{client_id:K,client_secret:U,code:t});case 2:return a=e.sent,n=a.data.token,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(){window.location.href="https://qiita.com/api/v2/oauth/authorize?client_id=".concat(K,"&scope=read_qiita")}var re=Object(j.f)((function(){var e=Object(n.useState)(!1),t=Object(m.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)([]),i=Object(m.a)(o,2),h=i[0],b=i[1],v=Object(n.useState)(null),g=Object(m.a)(v,2),x=g[0],y=g[1],k=Object(n.useState)(null),O=Object(m.a)(k,2),E=O[0],w=O[1],C=Object(n.useState)(null),_=Object(m.a)(C,2),S=_[0],B=_[1],A=Object(n.useState)(!1),N=Object(m.a)(A,2),q=N[0],I=N[1],L=Object(n.useState)(!1),R=Object(m.a)(L,2),D=R[0],T=R[1],M=Object(j.e)(),P=Object(j.d)();return Object(n.useEffect)((function(){document.title="Qiita Racer"}),[]),Object(n.useEffect)((function(){try{var e=JSON.parse(window.localStorage.getItem("users"));b(e||[])}catch(t){}}),[]),Object(n.useEffect)((function(){var e=new URLSearchParams(M.search),t=e.get("token")||window.localStorage.getItem("token"),a=e.get("code");a?function(e){return ae.apply(this,arguments)}(a).then((function(e){window.localStorage.setItem("token",e),P.push("?token=".concat(e)),B(e)})).catch((function(){window.localStorage.removeItem("token"),ne()})):t?function(e){return Z.apply(this,arguments)}(t).then((function(){B(t)})).catch((function(){window.localStorage.removeItem("token"),ne()})):ne()}),[]),S?r.a.createElement(G,null,r.a.createElement("div",{style:{background:"#fff",padding:16}},q&&r.a.createElement(d.a,{type:"error",message:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002",style:{marginBottom:8}}),D&&r.a.createElement(d.a,{type:"error",message:"LGTM\u304c1000\u3092\u8d85\u3048\u308b\u30e6\u30fc\u30b6\u30fc\u306f\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002",style:{marginBottom:8}}),r.a.createElement(s.a,{gutter:8},Array(8).fill(null).map((function(e,t){var a=h[t];return r.a.createElement(l.a,{key:t,md:6,sm:12,xs:24,style:{marginBottom:8}},r.a.createElement(f.a,{placeholder:"\u30e6\u30fc\u30b6\u30fcID\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",value:a,onChange:function(e){var a=Object(p.a)(h);a[t]=e.target.value,b(a)}}))}))),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement(u.a,{type:"primary",onClick:function(){var e=h.filter((function(e){return e}));0!==e.length&&(window.localStorage.setItem("users",JSON.stringify(e)),y(null),I(!1),T(!1),w(null),c(!0),te(e,S).then((function(t){y(t),w(e),c(!1)})).catch((function(e){console.log(e),"Over1000LikesCount"===e.message&&T(!0),c(!1),I(!0)})))},disabled:!S,loading:a},"\u30c7\u30fc\u30bf\u53d6\u5f97"))),r.a.createElement(Y,{data:x,loading:a,users:E})):r.a.createElement(G,null,r.a.createElement("div",null,"\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002"))}));var ce=function(){return r.a.createElement(i.a,null,r.a.createElement(re,null))};o.a.render(r.a.createElement(ce,null),document.getElementById("root"))},68:function(e,t,a){e.exports={iconWrapper:"src-components-ChartPlayer-index-module__iconWrapper--2KqqT",play:"src-components-ChartPlayer-index-module__play--1nv6S",stop:"src-components-ChartPlayer-index-module__stop--1SIZv"}},95:function(e,t,a){e.exports={header:"src-layouts-BasicLayout-index-module__header--2S57j",title:"src-layouts-BasicLayout-index-module__title--321a5",logo:"src-layouts-BasicLayout-index-module__logo--1Hx4w",spacer:"src-layouts-BasicLayout-index-module__spacer--1sAL6"}}},[[170,1,2]]]);
//# sourceMappingURL=main.8604e6bc.chunk.js.map